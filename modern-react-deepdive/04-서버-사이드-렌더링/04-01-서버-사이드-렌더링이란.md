# 1. 서버 사이드 렌더링이란?

## 1) 싱글 페이지 애플리케이션의 세상

### 싱글 페이지 애플리케이션이란?

> 렌더링, 라우팅에 필요한 대부분의 기능을 서버가 아닌 브라우저의 자바스크립트에 의존하는 방식을 의미

최초에 첫 페이지에서 데이터를 모두 불러온 이후, 페이지 전환을 위한 모든 작업이 자바스크립트와 브라우저의 history.pushState와 history.replaceState로 이뤄짐

최초에 하나의 HTML을 불러온 후 그 안에서 모든 작업을 처리하므로 싱글 페이지 애플리케이션이라고 함

페이지 전환 시 새로운 HTML 페이지를 요청하는 게 아니라 필요한 정보만 HTTP 요청으로 가져오고, 그 결과를 바탕으로 DOM 내부를 추가, 수정, 삭제하는 방법으로 페이지 전환

- 단점 : 최초 로딩해야할 자바스크립트 리소스가 커짐
- 장점 : 훌륭한 UI/UX 제공

### 전통적인 방식의 애플리케이션과 싱글 페이지 애플리케이션의 작동 비교

> 전통적인 방식

페이지 전환 발생할 때마다 새로운 페이지 요청
HTML 페이지를 다운로드해 파싱

> 싱글 페이지 애플리케이션

최초에 한 번 다소간의 로딩이 끝난 이후에는 페이지 전환이 모두 자바스크립트로 일어남

### 싱글 페이지 렌더링 방식의 유행과 JAM 스택의 등장

> 자바스크립트 위주의 싱글 페이지 렌더링 방식이 등장하게 된 배경

과거 PHP, JSP 방식
- 서버 사이드 렌더링
- 페이지를 요청하면 서버에서 완성된 HTML을 내려받음
- 자바스크립트는 사용자에게 추가적인 경험을 주기 위한 보조적인 수단

자바스크립트의 모듈화
- 자바스크립트가 다양한 작업을 수행하게 되며 모듈화 방안 논의
- CommonJS, AMD의 등장

Backbone.js, AngularJS, Knokout.js 등 등장
- 자바스크립트 수준에서 MVx 프레임워크 구현
- 자바스크립트에서도 서버에서만 할 수 있었던 복잡한 작업을 할 수 있다는 것을 의미

React, Vue, Angular의 시대
- 웹페이지의 모든 영역, 페이지의 렌더링에서부터 사용자의 인터랙션에 이르기까지 모두 아우를 수 있는 싱글 페이지 렌더링이 인기

JAM 스택의 등장
- 기존의 웹 개발은 LAMP 스택 (Linux, Apache, MySQL, PHP/Python)으로 구성되어 서버 의존적인 문제로 서버 확장하는 것이 어려웠음.
- JAM 스택(JavaScript, API, Markup)으로 프런트엔드의 리소스는 모두 클라이언트에서 실행되므로 서버 확장이 더 가능해짐

### 새로운 패러다임의 웹서비스를 향한 요구

- 자바스크립트의 코드 양이 증가하여 자바스크립트 파싱을 위한 CPU 소비 시간이 증가
- 모바일 기기의 성능이 좋아졌으에도 모바일 웹페이지 로딩 속도도 증가했음
> 사용자의 기기, 인터넷 속도 등이 개선됐음에도 실제 사용자들이 체감하는 로딩속도는 5년 전과 차이가 없거나 느리다.

## 2) 서버 사이드 렌더링이란?

사용자에게 보여줄 페이지를 서버에서 렌더링해 빠르게 사용자에게 화면을 제공하는 방식

위에서 언급한 내용대로 웹페이지가 점점 느려지는 상황을 개선하기 위해 기존 서버 사이드 렌더링이 부각됨

> 차이 : 웹페이지 렌더링의 책임을 어디에 두느냐

클라이언트 렌더링은 사용자 기기 성능의 영향을 받지만, 서버 사이드 렌더링은 비교적 안정적인 렌더링 가능

### 서버 사이드 렌더링의 장점

#### 최초 페이지 진입이 비교적 빠르다

HTTP 요청을 하는 것, HTML을 그리는 것 등 모두 서버에서 더 빠르다.

#### 검색 엔진과 SNS 공유 등 메타데이터 제공이 쉽다

검색 엔진 최적화에 유용하다.

1. 검색 엔진 로봇이 페이지에 진입
2. 페이지가 HTML 정보를 제공해 로봇이 이 HTML을 다운로드한다. 단, 다운로드만 하고 자바스크립트 코드는 실행하지 않는다.
3. 다운로드한 HTML 페이지 내부의 오픈 그래프나 메타 태그 정보를 기반으로 페이지의 검색 정보를 가져오고 이를 바탕으로 검색 엔진에 저장한다.

로봇은 페이지의 정적 정보를 가져오는 것이 목적이기 때문에 자바스크립트를 다운로드, 실행하지 않는다.

싱글 페이지 애플리케이션은 메타 정보 또한 자바스크립트에 의존한다. 싱글 페이지에 검색 엔진이 방문했을 때, 이러한 메타 정보를 제공할 수 있도록 조치를 취하지 않는다면 검색 엔진 최적화에 불리하다.

서버 사이드 렌더링은 최초의 렌더링 작업이 서버에서 발생하여 검색 엔진에게 제공할 정보를 가공해서 HTML로 제공하므로 검색 엔진 최적화 대응에 용이하다.

#### 누적 레이아웃 이동이 적다

서버 사이드 렌더링은 누적 이동(Cumulative Layout Shift)을 줄일 수 있다.

- 누적 레이아웃 이동 : 사용자에게 페이지를 보여준 뒤에 뒤늦게 어떤 HTML 정보가 추가되거나 삭제되어 마치 화면이 덜컥 거리는 부정적인 사용자 경험

#### 사용자 디바이스 성능에 비교적 자유롭다

자바스크립트 리소스 실행은 사용자의 디바이스에서만 실행되므로 절대적으로 사용자 디바이스 성능에 의존적이다.

서버 사이드 렌더링에선 이 부담을 서버에 나눌 수 있다.

#### 보안에 좀 더 안전하다

JAM 스택의 문제점은 애플리케이션의 모든 활동이 브라우저에 노출된다는 것.

서버 사이드 렌더링에서 인증 혹은 민감한 작업을 서버에서 수행하고 그 결과만 브라우저에 제공해 보안 위협을 피할 수 있다.

### 단점

#### 소스 코드 작성 시 항상 서버를 고려해야 한다

> 문제는 브라우저 전역 객체인 window, sessinoStorage 등

#### 적절한 서버가 구축돼 있어야 한다

사용자의 요청을 받아 렌더링을 수행할 서버가 필요하다. 물리적인 가용량 확보, 예기치 않은 장애 상황에 대응할 수 있는 복구 전략, 요청 분산 및 서버 다운을 대비해 PM2 같은 프로세스 매니저의 도움 등이 필요하다.

프로덕션 서버 사이드 렌더링 애플리케이션을 운영하면 쿠버네티스 등의 도움을 얻더라도 쉽지 않다.

#### 서비스 지연에 따른 문제

싱글 페이지 애플리케이션에서는 느린 작업을 수행할 때 '로딩 중'과 같은 표시가 가능하지만, 서버 사이드 렌더링에서는 서버에서 렌더링 작업이 끝날 때까지 사용자에게 그 어떤 정보도 제공할 수 없다.

다양한 요청과 작업에 따른 병목 현상이 심해진다면 서버 사이드 렌더링이 더 안 좋은 사용자 경험을 제공할 수도 있다.

## 3) SPA와 SSR을 모두 알아야 하는 이유

### 서버 사이드 렌더링 역시 만능이 아니다

웹페이지의 설계와 목적, 그리고 우선순위에 따라 싱글 페이지 애플리케이션이 더 효율적일 수도 있다.

### 싱글 페이지 애플리케이션과 서버 사이드 렌더링 애플리케이션

1. 가장 뛰어난 싱글 페이지 애플리케이션은 가장 뛰어난 멀티 페이지 애플리케이션보다 낫다. 멀티 페이지 애플리케이션 또한 마찬가지로 엄청난 최적화를 했다하더라도 싱글 페이지 애플리케이션이 가진 브라우저 API와 자바스크립트를 활용한 라우팅 기반의 매끄러운 라우팅보다 뛰어난 성능을 보여줄 순 없을 것이다.
2. 평균적인 싱글 페이지 애플리케이션은 평균적인 멀티 페이지 애플리케이션보다 느리다. 일반적인 싱글 페이지 애플리케이션은 렌더링과 라우팅에 최적화되어 있지 않다면 사용자 기기에 따라 다른 성능을 가지므로 멀티 페이지 애플리케이션 대비 성능이 이쉬울 가능성이 크다.

### 현대의 서버 사이드 렌더링

요즘 서버 사이드 렌더링은 두 가지 장점(서버 사이드 렌더링의 초기 페이지 진입이 빠름, 싱글 페이지 렌더링의 빠른 라우팅 방식)을 모두 취한 방식
- 최초 웹사이트 진입 시 서버 사이드 렌더링 방식으로 서버에서 완성된 HTML을 제공하고, 이후 라우팅에서는 서버에서 내려받은 자바스크립트를 바탕으로 싱글 페이지 애플리케이션처럼 작동한다.
