
# 4. 렌더링은 어떻게 일어나는가?

- 리액트의 렌더링 = 브라우저가 렌더링에 필요한 DOM 트리를 만드는 과정

> 리액트 자체적인 렌더링 프로세스를 이해하는 것은 곧 리액트를 이해하는 것!

- 리액트 개발자라면 렌더링이 어떻게, 왜, 어떤 순서로 일어나는지 알며 이러한 렌더링 과정을 최소한으로 줄여야 한다!

## 1) 리액트의 렌더링이란?

> 브라우저의 렌더링과 리액트의 렌더링은 다르다!

- 리액트의 렌더링 : 리액트 애플리케이션 트리 내의 모든 컴포넌트들이 props, state 기반으로 UI를 구성하고 어떤 DOM 결과를 브라우저에게 제공할 것인지 계산하는 과정

## 2) 리액트의 렌더링이 일어나는 이유

1. 최초 렌더링 : 처음 애플리케이션에 진입했을 때 브라우저에게 최초 렌더링 결과물 제공
2. 리렌더링 : 최초 렌더링 이후의 모든 렌더링

### 리렌더링이 발생하는 경우

- 클래스 컴포넌트의 setState가 실행되는 경우
- 클래스 컴포넌트의 forceUpdate가 실행되는 경우
- 함수 컴포넌트의 useState()의 setter가 실행되는 경우
- 함수 컴포넌트의 useReducer()의 dispatch가 실행되는 경우
- 컴포넌트의 key props가 변경되는 경우
- props가 변경되는 경우
- 부모 컴포넌트가 렌더링될 경우
  - 부모 컴포넌트가 리렌더링되면 자식 컴포넌트도 무조건 리렌더링된다.

#### 왜 key가 필요할까?

- key : 리렌더링이 발생하는 동안 형제 요소들 사이에서 동일한 요소를 식별하는 값

동일한 자식 컴포넌트가 여러 개 있는 구조에서 리렌더링이 발생하면 어떤한 컴포넌트가 변경이 있었는지 구별해야 하는데, current 트리와 workInProgress 트리의 두 트리 사이에서 같은 컴포넌트인지를 구별하는 값이다.

이렇게 변경 사항을 구별하는 작업은 리렌더링이 필요한 컴포넌트를 최소화하기 위함이다.

#### 상태 관리 라이브러리 사용시 mobx-react, react-redux와 같은 리액트 패키지를 설치하는 이유

MobX와 Redux는 어디선가 상태를 관리하지만, 이 상태 관리가 리액트의 리렌더링으로 이어지지는 않는다. mobx-react, react-redux가 변경된 상태를 바탕으로 위에서 언급한 방법 중 하나를 사용해 리렌더링을 발생시킨다.

recoil과 같은 경우 별도의 리액트 패키지가 필요없는데, 이 경우 리액트 내부의 useState 등을 통해 리렌더링을 발생시키기 때문이다.

## 3) 리액트의 렌더링 프로세스

jsx 문법으로 구성된 렌더링 결과물은 자바스크립트로 컴파일되면서 React.createElement()를 호출하는 구문으로 변환된다. createElement는 브라우저의 UI 구조를 설명할 수 있는 일반적인 자바스크립트 객체를 반환한다.

### 변환 전
```
function Hello(){
  return (
    <TestComponent a={35} b="yceffort">
      안녕하세요
    </TestComponent>
  )
}
```

### 변환 후
```
function Hello(){
  return React.createElement(
    TestComponent,
    { a: 35, b: 'yceffort'},
    '안녕하세요',
  )
}
```

### 결과물
```
{type: TestComponent, props: {a: 35, b: 'yceffort', children: '안녕하세요'}}
```

이러한 과정을 거쳐 각 컴포넌트의 렌더링 결과물을 수집하고, 가상 DOM과 비교해 실제 DOM에 반영하기 위한 변경 사항을 수집한다. (= Reconciliation 재조정)

이러한 재조정 과정이 모두 끝나면 모든 변경 사항을 동기 시퀀스로 DOM에 적용한다.

리액트의 렌더링은 '렌더 단계'와 '커밋 단계'로 나뉘어 실행된다.

## 4) 렌더와 커밋

렌더
- 컴포넌트를 렌더링하고 변경 사항을 계산하는 모든 작업
커밋
- 렌더 단계의 변경 사항을 실제 DOM에 적용해 사용자에게 보여주는 과정
- 커밋 단계가 끝나야 비로소 브라우저의 렌더링 발생

> 리액트의 렌더링이 일어난다고 해서 무조건 DOM 업데이트가 일어나는 것은 아니다.

- 감지된 변경 사항이 없다면 커밋 단계는 생략 -> 브라우저의 DOM 업데이트 미발생

> 리액트의 렌더링은 항상 동기적으로 작동'했다.' (과거형)

- 리액트 18에서 동시서 렌더링이 도입
- 렌더 단계가 비동기로 작동해 특정 렌더링의 우선순위를 낮추거나 재시작하거나 포기

